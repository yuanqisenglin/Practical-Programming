# 使用指南

## 1. 环境准备

### 1.1 安装Python

确保系统已安装Python 3.8或更高版本。

### 1.2 安装依赖

```bash
pip install -r requirements.txt
```

### 1.3 配置LLM API（可选）

如果要使用真实的LLM API进行意图识别，需要设置API密钥：

**方式1：环境变量**
```bash
# Windows
set OPENAI_API_KEY=your_api_key_here

# Linux/Mac
export OPENAI_API_KEY=your_api_key_here
```

**方式2：命令行参数**
```bash
python src/main.py --script scripts/customer_service.dsl --api-key your_api_key_here
```

如果不配置API密钥，系统将使用模拟意图识别器（MockIntentAnalyzer）。

## 2. 运行程序

### 2.1 基本运行

```bash
python src/main.py --script scripts/customer_service.dsl
```

### 2.2 使用模拟LLM

```bash
python src/main.py --script scripts/customer_service.dsl --mock
```

### 2.3 指定用户ID

```bash
python src/main.py --script scripts/customer_service.dsl --user-id user123
```

## 3. 编写DSL脚本

### 3.1 创建脚本文件

创建一个`.dsl`文件，例如`my_script.dsl`。

### 3.2 编写脚本内容

参考`scripts/`目录下的示例脚本，按照DSL语法规范编写。

### 3.3 运行自定义脚本

```bash
python src/main.py --script my_script.dsl
```

## 4. 运行测试

### 4.1 运行所有测试

```bash
python tests/run_tests.py
```

### 4.2 运行特定测试

```bash
python -m unittest tests.test_lexer
python -m unittest tests.test_parser
python -m unittest tests.test_interpreter
python -m unittest tests.test_intent_analyzer
```

## 5. 示例脚本说明

### 5.1 customer_service.dsl

通用客服场景脚本，支持：
- 订单查询
- 退款申请
- 物流查询
- 产品咨询
- 投诉建议

### 5.2 order_inquiry.dsl

订单查询专用场景，专注于订单相关的查询和处理。

### 5.3 refund_process.dsl

退款处理专用场景，包含完整的退款申请流程。

## 6. 交互式使用

运行程序后，进入交互模式：

1. 系统会输出欢迎信息和提示
2. 输入您的需求（自然语言）
3. 系统会根据意图识别结果执行相应的流程
4. 按照提示继续交互
5. 输入`quit`或`exit`退出

**示例交互**:
```
系统: 欢迎使用智能客服系统！我是您的专属客服助手。
系统: 我可以帮助您处理以下业务：
系统: 1. 订单查询
系统: 2. 退款申请
系统: 3. 物流查询
系统: 4. 产品咨询
系统: 5. 投诉建议
系统: 请告诉我您需要什么帮助？

您: 我想查询订单

系统: 好的，我来帮您查询订单信息。
系统: 请输入您的订单号：

您: 1234567890

系统: 正在为您查询订单号为 1234567890 的订单信息...
```

## 7. 多线程支持

系统支持多用户并发访问。每个用户有独立的执行上下文，包括：
- 独立的变量表
- 独立的当前Step状态
- 线程安全的操作

在实际应用中，可以通过不同的`user_id`来区分不同用户。

## 8. 故障排除

### 8.1 脚本解析错误

如果遇到脚本解析错误，检查：
- 语法是否正确
- 大括号是否匹配
- 关键字拼写是否正确

### 8.2 意图识别失败

如果意图识别不准确：
- 检查LLM API配置是否正确
- 尝试使用更明确的用户输入
- 考虑使用模拟模式进行测试

### 8.3 变量未定义

如果变量未定义：
- 确保在使用变量前已通过`set`或`listen`设置
- 检查变量名拼写是否正确

## 9. 开发建议

1. **测试驱动**: 先编写测试用例，再实现功能
2. **模块化**: 将不同业务场景拆分到不同脚本
3. **文档化**: 为复杂逻辑添加注释
4. **版本控制**: 使用Git管理代码版本

